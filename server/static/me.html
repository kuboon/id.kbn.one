<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#1d4ed8" />
    <title>kbn.one ID</title>
    <link rel="icon" href="data:image/png;base64,iVBORw0KGgo=" />
    <link rel="manifest" href="manifest.json" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="page">
      <header class="page-header">
        <div class="brand">
          <h1 id="brand">kbn.one ID</h1>
        </div>
      </header>

      <div class="toast-region" aria-live="polite" aria-atomic="true">
        <div
          class="toast"
          id="status"
          data-status="info"
          data-visible="true"
          role="status"
        >
          準備が整いました。
        </div>
      </div>
      <button type="button" id="logout" class="secondary">
        ログアウト
      </button>
      <section id="account-view" class="panel" hidden>
        <div class="card">
          <header class="section-header">
            <h2>プロフィール情報</h2>
          </header>
          <form id="profile-form" class="stack">
            <label class="field" for="account-username">
              <span>ユーザー名</span>
              <input
                id="account-username"
                type="text"
                name="username"
                autocomplete="username"
                required
              />
            </label>
            <div class="button-row align-start">
              <button type="submit" class="primary">変更を保存</button>
            </div>
          </form>
        </div>

        <div class="card">
          <header class="section-header">
            <div>
              <h2>パスキー</h2>
              <p class="hint">
                新しいデバイスを登録したり、不要な鍵を削除できます。
              </p>
            </div>
            <div class="section-actions">
              <button
                type="button"
                id="add-passkey"
                class="secondary accent"
              >
                別の鍵を追加
              </button>
            </div>
          </header>
          <ul id="credential-list" class="credentials">
            <li class="empty">パスキーを読み込んでいます…</li>
          </ul>
          <template id="credential-item-template">
            <li>
              <div class="credential-header">
                <strong data-role="credential-title"></strong>
              </div>
              <dl class="credential-meta">
                <div>
                  <dt>登録日</dt>
                  <dd
                    data-role="credential-created"
                    style="font-weight: 500"
                  >
                  </dd>
                </div>
                <div>
                  <dt>最終使用日</dt>
                  <dd
                    data-role="credential-last-used"
                    style="font-weight: 500"
                  >
                  </dd>
                </div>
              </dl>
              <div class="credential-actions">
                <button
                  type="button"
                  class="link"
                  data-action="edit-credential"
                >
                  変更
                </button>
                <button
                  type="button"
                  class="link"
                  data-action="delete-credential"
                >
                  削除
                </button>
              </div>
            </li>
          </template>
        </div>

        <div class="card" id="push-card">
          <header class="section-header">
            <div>
              <h2>通知</h2>
              <p class="hint" id="push-summary">
                スマートフォンやブラウザーに web push 通知を送信できます。
              </p>
            </div>
            <div class="section-actions">
              <button type="button" id="enable-push" class="secondary accent">
                通知を有効化
              </button>
            </div>
          </header>
          <ul id="push-subscription-list" class="credentials">
            <li class="empty">通知設定を読み込んでいます…</li>
          </ul>
        </div>
      </section>
      <button type="button" id="delete-account" class="danger">
        アカウントを削除
      </button>
    </main>

    <dialog id="passkey-dialog">
      <form id="passkey-form" class="dialog-form">
        <h2>パスキーを追加</h2>
        <p class="hint">
          このデバイスの情報から自動的に名前を付けて保存します。
        </p>
        <div class="button-row align-end">
          <button type="button" id="cancel-passkey-dialog" class="secondary">
            キャンセル
          </button>
          <button type="submit" id="submit-passkey-dialog" class="primary">
            追加
          </button>
        </div>
      </form>
    </dialog>

    <dialog id="credential-dialog">
      <form id="credential-form" class="dialog-form">
        <h2>パスキーの名前を変更</h2>
        <label class="field" for="credential-nickname">
          <span>表示名</span>
          <input
            id="credential-nickname"
            name="nickname"
            type="text"
            placeholder="名前のないデバイス"
            autocomplete="off"
            required
          />
        </label>
        <div class="button-row align-end">
          <button
            type="button"
            id="cancel-credential-dialog"
            class="secondary"
          >
            キャンセル
          </button>
          <button type="submit" id="submit-credential-dialog" class="primary">
            保存
          </button>
        </div>
      </form>
    </dialog>

    <dialog id="push-device-dialog">
      <form id="push-device-form" class="dialog-form">
        <h2>通知デバイスの名前を変更</h2>
        <label class="field" for="push-device-name">
          <span>表示名</span>
          <input
            id="push-device-name"
            name="deviceName"
            type="text"
            placeholder="登録済みデバイス"
            autocomplete="off"
            required
          />
        </label>
        <div class="button-row align-end">
          <button
            type="button"
            id="cancel-push-device-dialog"
            class="secondary"
          >
            キャンセル
          </button>
          <button
            type="submit"
            id="submit-push-device-dialog"
            class="primary"
          >
            保存
          </button>
        </div>
      </form>
    </dialog>

    <script type="module" src="me.ts"></script>
  </body>
</html>
